<!DOCTYPE html>
<html style="
			 /*
			 overflow: hidden;
			 */
	">
<head>

    <link rel="manifest" href="manifest.json" />

  <meta charset="utf-8">
  <title>2584</title>

  <!-- main.css only has colors for fibonacci pieces -->
  <!-- ./style/main_copy_from_original.css has all the important style (i.e. mobile etc.) and must come afterwards -->
  <link href="style/main.css" rel="stylesheet" type="text/css">
  <link href="style/main_supplement.css" rel="stylesheet" type="text/css">

  <!-- <link rel="shortcut icon" href="favicon.ico"> -->
  <link rel="shortcut icon" href="2584.png">
  <link rel="apple-touch-icon" href="meta/apple-touch-icon.png">
  <link rel="apple-touch-startup-image" href="meta/apple-touch-startup-image-640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"> <!-- iPhone 5+ -->
  <link rel="apple-touch-startup-image" href="meta/apple-touch-startup-image-640x920.png"  media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"> <!-- iPhone, retina -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body>
  <div class="container">
    <div class="heading">
      <h1 class="title">2584 - Fibonacci's 2048</h1>
      <div class="scores-container">
        <div class="score-container">0</div>
        <div class="best-container">0</div>
      </div>
    </div>

    <div class="above-game">
      <p class="game-intro">Join the numbers and get to the <strong>2584 tile!</strong></p>
	  <!-- <input type="button" value="Reload &amp; Update App" onclick="javascript:location.reload()"> -->
	  <a class="button" type="button" onclick="javascript:location.reload()">
		  <span style="
    line-height: 1em;
    writing-mode: tb-rl;
    /* transform: rotate(294deg); */
">&#x21bb;</span>
	  <!-- ⟳ -->
	  Reload &amp; Update App
	  </a>
      <a class="restart-button">New Game</a>
    </div>

    <div class="game-container">
      <div class="game-message">
        <p></p>
        <div class="lower">
	        <a class="keep-playing-button">Keep going</a>
          <a class="retry-button">Try again</a>
        </div>
      </div>

      <div class="grid-container">
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
      </div>

      <div class="tile-container">

      </div>
    </div>

	<p class="game-explanation">
	<p>

	<details id="swipe_sensitivity_explanation">
		<summary style="/*display: flex;*/ /* somehow hides expand button */ /*justify-content: space-evenly;*/ /*doesn't work if display not flex etc. */ line-height: 2.5em /*max value compatible with input height*/;">
			<span style="">
				Swipe sensitivity: 
				<span id="swipe_sensitivity_value_display" style="font-family: monospace; white-space: pre;">30.0</span>
			</span>
			<input id="sensitivity_slider" type="range" min="0" max="1" value="0.3" step="0.01" style="margin: 4px;margin-left: .5em; margin-bottom: .5em; vertical-align: middle;">
		</summary>
		<div class="expanded">Number of pixels to swipe to move. Lower value = more sensitive</div>
	</details>

	<details id="chain_moves_explanation">
		<summary style="/*line-height: 2.5em*/">
			<span style="">
				Multiple moves per swipe: 
			</span>
			<input id="chain_moves_checkbox" type="checkbox" style="/* margin: 4px;margin-left: .5em; margin-bottom: .5em; vertical-align: middle;*/">
		</summary>
		<div class="expanded">Allow multiple moves with one swipe</div>
	</details>
	<details id="vibration_explanation">
		<summary style="line-height: 2.5em">
			<span style="">
				Vibration: 
			</span>
			<input id="vibration_checkbox" type="checkbox">
		</summary>
		<div class="expanded">Vibration for smartphone/tablet</div>
	</details>
	<details id="game_mode_explanation">
		<summary>
			Game mode:
			<input type="radio" id="game_mode_normal" name="game_mode" value="normal"><label>Normal (2048)</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="fibonacci" checked><label>Fibonacci (2584)</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="stupid" checked><label>Stupid (Anything goes)</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="tribonacci" checked><label>Tribonacci</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="custom_sequence" checked><label>Custom Sequence</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="powers_of_3" checked><label>Powers of 3</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="powers_of_4" checked><label>Powers of 4</label>
			<input type="radio" id="game_mode_fibonacci" name="game_mode" value="powers_of_5" checked><label>Powers of 5</label>
		</summary>
		<div class="expanded">
			<strong>Normal: </strong>
			Same numbers add up, i.e. 1 + 1 = 2, 2 + 2 = 4, 4 + 4 = 8, 8 + 8 =16, ...
			<br>
			<strong>Fibonacci: </strong>
			Consecutive Fibonacci numbers add up, i.e. 1 + 1 =2, 1 + 2 = 3, 2 + 3 = 5, 3 + 5 = 8, ...
			<br>
			<strong>Tribonacci: </strong>
			<!-- The tribonacci sequence is defined by the recusion a~n~ = a~n-1~ + a~n-3~, and therefore goes 1, 1, 1, 2, 3, 4, 6, 9, 13, 19, 28, 41, 60, 88, 129, ... -->
			The tribonacci sequence is defined by the recusion a<sub>n</sub> =
			a<sub>n-1</sub> + a<sub>n-3</sub>, and therefore goes 1, 1, 1, 2, 3, 4,
			6, 9, 13, 19, 28, 41, 60, 88, 129, …
			<br>
			You can add up to numbers if they are two places apart in this sequence ((1,3) or the larger number twice to 2.5 times as big as the smaller one).
					Explicit formula
<a href="./tribonacci.md.html">here</a>.
			<br>
			<strong>Custom Sequence:</strong>Change the value of the array
<code>custom_sequence</code> in the devtools console (<kbd>Ctrl</kbd> + <kbd>Shift</kbd> +<kbd>J</kbd>)
</div>
</details>
	<style>
input[type="range"] {
	accent-color: #3d81fb;
}
input[type="range"]::-webkit-slider-runnable-track {
	background-color: none;
	/*height: 1em;*/
	/*border: 1px solid #b2b2b2;*/
	border-radius: 0.5em;
}

a.button {
	margin: 0.2em;
}

:root {
	--text-color: #776e65;
	--background-color: #faf8ef;
}
.expanded {
	font-size: 90%;
	animation: kf-color-mix 1s -.9s linear forwards paused;
	color: currentColor;
}
  @keyframes kf-color-mix {
	  /*0% { color: var(--background-color) }*/
	  0% { color: #fff }
	  100% { color: var(--text-color) }
	  }
  @media screen and (max-width: 520px) { .above-game {
		  flex-wrap: wrap;
  }
  }
	</style>

	<!-- <abbr id="swipe_sensitivity_explanation" title="Number of pixels to swipe to move. Lower value = more sensitive">Swipe sensitivity</abbr>: -->
	<!-- <script> -->
		<!-- 	let swipe_sensitivity_explanation = document.querySelector('abbr#swipe_sensitivity_explanation') -->
			<!-- 	swipe_sensitivity_explanation.on -->
			<!-- </script> -->
	<!-- <span id="swipe_sensitivity_value_display" style="font-family: monospace; white-space: pre;">30.0</span> -->
	<!-- <input id="sensitivity_slider" type="range" min="0" max="200" value="30"> -->
	<!-- input::after doesn't update -->
	<!-- <style> -->
<!-- input::after { -->
	<!-- content: attr(value); -->
	<!-- } -->
	<!-- </style> -->
	<script>
		let GAMETABLE = {
			'normal':0,
			'fibonacci':1,
		}

		let game_mode = localStorage.game_mode??'fibonacci'
		 document.querySelector('input[type="radio"][name="game_mode"][value="'+game_mode+'"]').checked=true

let GAMEMODE = GAMETABLE[game_mode];
		let game_mode_buttons = document.querySelectorAll('input[type="radio"][name="game_mode"]')
		function update_game_mode() {
			//debugger
			game_mode = document.querySelector('input[type="radio"][name="game_mode"]:checked').value
			GAMEMODE = (game_mode=='fibonacci')?1:0
			localStorage.game_mode=game_mode
			update_title()
		}

		let titles = {
			'fibonacci' : 2584,
			'normal' : 2048,
			'tribonacci' : 2745,
		}

		function update_title() {
	document.querySelector('.title').innerText=titles[game_mode]??2584
}



		for (let game_mode_button of game_mode_buttons){
			game_mode_button.addEventListener('change',
				update_game_mode
			)

		}

		let chain_moves = Boolean(localStorage?.chain_moves ?? 0)
		let chain_moves_checkbox = document.querySelector('#chain_moves_checkbox')
		chain_moves_checkbox.checked =chain_moves
		chain_moves_checkbox.onchange = () => {
			chain_moves =chain_moves_checkbox.checked
			localStorage.chain_moves = chain_moves
		}

		let vibration = Boolean(localStorage?.vibration ?? 0)
		let vibration_checkbox = document.querySelector('#vibration_checkbox')
		vibration_checkbox.checked =vibration
		vibration_checkbox.onchange = () => {
			vibration =vibration_checkbox.checked
			localStorage.vibration = vibration
		}

		let default_sens = 30
		let sensitivity_slider = document.querySelector('#sensitivity_slider')
		let swipe_sensitivity_value_display = document.querySelector('#swipe_sensitivity_value_display')
		let exponent = 2
		let sens_max = 200
		let sens_min = 1
		let scale_sens = value => sens_min+value**exponent * (sens_max - sens_min )
		let inv_scale_sens = sens => ((sens - sens_min)/(sens_max - sens_min))**(1/exponent)

		let default_sens_slider = inv_scale_sens(default_sens)

		let swipe_sensitivity = +(localStorage?.swipe_sensitivity ?? default_sens)
		sensitivity_slider.value=+(localStorage?.sensitivity_slider_value ?? inv_scale_sens(swipe_sensitivity))
		swipe_sensitivity_value_display.innerText=swipe_sensitivity.toPrecision(3).padStart(4,' ')

		sensitivity_slider.oninput = () => {
			swipe_sensitivity = scale_sens( +sensitivity_slider.value) // <input> value is always string
			swipe_sensitivity_value_display.innerText=swipe_sensitivity.toPrecision(3).padStart(4,' ')
		}

		sensitivity_slider.onchange = () => {
			//debugger
			localStorage.swipe_sensitivity=swipe_sensitivity
			localStorage.sensitivity_slider_value=sensitivity_slider.value
		}
	</script>
	</p>
	<strong class="important">How to play:</strong> Use your 

	<strong>a gamepad (NEW!)</strong>,
	<strong>arrow keys</strong>, 
	<strong>WASD</strong>, <strong>HJKL</strong>
	or swipe to move the tiles. 
	<!-- When two tiles with the same number touch, they <strong>merge into one!</strong> -->
	When two neighboring Fibonacci numbers touch, they <strong>add up</strong> and gibe <strong>the next Fibonacci number!</strong>
	</p>
	<!-- <hr> -->
	<!-- <p> -->
	<!-- <strong class="important">Note:</strong> This site is the official version of 2048. You can play it on your phone via <a href="http://git.io/2048">http://git.io/2048.</a> All other apps or sites are derivatives or fakes, and should be used with caution. -->
	<!-- </p> -->
	<hr>
	<p>
	2584 by <a href="https://perguto.github.io" target="_blank">perguto.</a>
	2048 created by <a href="http://gabrielecirulli.com" target="_blank">Gabriele Cirulli.</a> Based on <a href="https://itunes.apple.com/us/app/1024!/id823499224" target="_blank">1024 by Veewo Studio</a> and conceptually similar to <a href="http://asherv.com/threes/" target="_blank">Threes by Asher Vollmer.</a>
	</p>
		</div>

		<script>
			navigator.serviceWorker.register('sw.js')
		</script>

		<script src="js/bind_polyfill.js"></script>
		<script src="js/classlist_polyfill.js"></script>
		<script src="js/animframe_polyfill.js"></script>

		<!-- BS 3rd party lib -->
		<!-- <script src="gamepad.js"></script> -->
		<script src="gamepad_controls.js"></script>

		<script src="js/keyboard_input_manager.js"></script>
		<script src="js/html_actuator.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/tile.js"></script>
		<script src="js/local_storage_manager.js"></script>
		<script src="js/game_manager.js"></script>
		<script src="js/application.js"></script>
</body>
</html>
